<!DOCTYPE html>
<html>

<head>
    <title>Concept 2 Logbook | Contributions Graph</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
    </style>
</head>

<body>
    <img src="blue.png" alt="Concept 2 Logo">
    <h1>Concept 2 Logbook | Contributions Graph</h1>
    <p>Connect with you API token to get your graph</p>
    <div>
        <input id="token_input" placeholder="<API token>" maxlength="41" name="APItoken" type="text">
        <button id="connect_btn">Connect</button>
    </div>
</body>

<script>
    var data = [];
    async function get_data_from_url(url, contiue = true) {
        const myHeaders = new Headers();
        myHeaders.append("Content-Type", "application/json\n");
        myHeaders.append("Authorization", "Bearer " + token_input.value);
        const requestOptions = {
            method: "GET",
            headers: myHeaders,
            redirect: "follow"
        };
        response = await fetch(url, requestOptions);
        if (response.status == 200) {
            result = await response.json();
            // append result.data to data
            data = data.concat(result.data);
            // console.log(result);
            if (contiue && result.meta.pagination.links.next) {
                await get_data_from_url(result.meta.pagination.links.next, contiue);
            }
        } else {
            alert("Invalid token");
        }
    }
    connect_btn.onclick = async function () {
        console.log(token_input.value + " is the token");
        await get_data_from_url("https://log.concept2.com/api/users/me/results?page=10");
    }
</script>

</html>